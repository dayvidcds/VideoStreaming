<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>VideoFlix</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
        table {
            width: 600px;
            height: 20px;
            float: left;
            top: 70px;
            position: relative;
        }
        
        video {
            top: -2px;
            position: relative;
            float: right;
        }
        
        table th {
            padding: 5px;
            margin: 5px;
            border: 1px solid #ccc;
        }
        
        h2 {
            top: 450px;
            position: relative;
            float: right;
            left: 70px;
        }
        
        td {
            padding: 5px;
            margin: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body style="text-align:center">
    <div style="margin:0 auto;">
        <h1>VideoFlix</h1><br>
        <input type="text" id="texto">
        <button id="botao">Buscar</button>
        <div id="tb">
            <table>
                <tr>
                    <th>TÃ­tulo</th>
                    <th>Palavras chave</th>
                </tr>
                <tbody id="tabela"></tbody>
            </table>
        </div>
    </div>
    <video id="v1" width="640" height="480" controls="controls"></video><br>
    <h2>teste</h2>
    </div>

    <script>
        var resu = null

        $('#botao').click(function() {

            var tags = $('#texto').val();
            $('#tabela').empty()

            $.get('http://192.168.137.240:4000/dns/findByAddress/' + 'balancer01.com', function(result) {

                console.log(result)

                $.get('http://' + result.ipaddr + '/node/findContentByTags/' + tags, function(dados) {

                    console.log('BALANCER->NODES = ', dados)

                    if (Array.isArray(dados)) {

                        for (var i = 0; i < dados.length; i++) {

                            console.log(dados[i])

                            $.get('http://192.168.137.240:4000/dns/findByAddress/' + dados[i].address, function(result) {

                                $.get('http://' + result.ipaddr + '/film/findByTags/' + tags, function(dados) {


                                    if (Array.isArray(dados)) {
                                        for (var i = 0; dados.length > i; i++) {
                                            $('#tabela').append('<tr><td id="' + result.ipaddr + '"onClick="buscar(' + 'this' + ')"> ' + dados[i].title + '</td>' + '<td>' + dados[i].tags + '</td></tr>')
                                        }
                                    }

                                })

                            })
                        }
                    }
                })

            })
        })

        function buscar(event) {
            var title = event.textContent
            var end = $(event).prop('id')
            $.get('http://' + end + '/film/find/' + title, function(result) {
                //alert(result.msg)
                console.log('RESULT FILME => ', result)
                $('#v1').attr('src', 'http://' + end + '/film/streaming/play/' + result.res.route_video);
            })
        }
    </script>

</body>

</html>